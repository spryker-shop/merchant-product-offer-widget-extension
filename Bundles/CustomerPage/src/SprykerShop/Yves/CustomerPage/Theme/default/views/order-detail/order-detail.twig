{% extends template('page-layout-customer', 'CustomerPage') %}

{% define data = {
    order: _view.order,
    orderItems: _view.items,

    title: 'customer.account.order_history' | trans,
    activePage: 'order'
} %}

{% block customerContent %}

    {% embed [
        molecule('customer-reorder-form', 'CustomerReorderWidget'),
        molecule('order-detail', 'CustomerPage'),
    ] ignore missing with {
        data: {
            idSalesOrder: data.order.idSalesOrder,
            orderItems: data.orderItems,
            order: data.order
        }
    } only %}
        {% block formContent %}
            {% include molecule('order-detail', 'CustomerPage') with {
                data: {
                    order: data.order,
                    orderItems: data.orderItems
                }
            } only %}
        {% endblock %}

        {% block orderDetailContent %}
            {{ widgetBlock('CustomerReorderWidgetPlugin', 'formStart', data.order) }} {# @deprecated Use molecule('customer-reorder-form', 'CustomerReorderWidget') instead. #}

            {{ parent() }}

            {{ widgetBlock('CustomerReorderWidgetPlugin', 'formActions', data.order) }} {# @deprecated Use molecule('customer-reorder-form', 'CustomerReorderWidget') instead. #}
            {{ widgetBlock('CustomerReorderWidgetPlugin', 'formEnd', data.order) }} {# @deprecated Use molecule('customer-reorder-form', 'CustomerReorderWidget') instead. #}
        {% endblock %}
    {% endembed %}

    <div class="box">
        {% widget 'CommentThreadWidget' args [
            data.order.idSalesOrder,
            'sales_order',
            app.request.requestUri,
            data.order.commentThread
        ] only %}
        {% endwidget %}
    </div>
{% endblock %}
